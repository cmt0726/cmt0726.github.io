<!DOCTYPE html>
<html id="doc">
<head>
        <meta charset="utf-8">
    <title>Pizza Picker</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="pizzaindex.css"/>
    <script  src="data.json"></script>   
    <script data-main="scripts/page/common" type="text/javascript" src="scripts/require.js"></script>
    <script>
        
            require(['common'],function(){
                require(['search']);
                require(['zipsearch']);
                //require(['objectTest']);
                //require(['pizzaindex.mjs']);               
            });
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDiGZCq3s2uzVqCbsiKOeUYvF6xJQ3Wtng&callback=initialize"
    type="text/javascript">
    </script>

    <script>
        const Url = 'https://maps.googleapis.com/maps/api/place/textsearch/json?query=pizza+in+Ellensburg&key=AIzaSyBbTOqK2j2A-iIAdAcC7I4s8K39Iw1reIU';
        
        $(document).ready(function(){
            $('#button2').click(function(){
                var data={
                    userZip: $('#zaddress').val()
                }
                const Url = `https://maps.googleapis.com/maps/api/place/textsearch/json?query=pizza+near+${ data.userZip }&key=AIzaSyBbTOqK2j2A-iIAdAcC7I4s8K39Iw1reIU`;
                console.log(data.userZip)
                $.ajax({
                    url: Url,
                    type: "POST",
                    contentType: 'application/json',
                    dataType: 'json',
                    headers: {
                        'Access-Control-Allow-Headers': 'Origin, Content-Type, X-Auth-Token',
                        "Content-Type":"application/json",
                        'Access-Control-Allow-Origin':'*',
                        'Access-Control-Allow-Methods':'GET, POST'
                    },
                    success: function(result){ 
                        console.log('test');                     
                        function codeAddress() {
                            for(let i = 0; i < 10; i++) {
                                geocoder.geocode( { 'address': result.results[i].formatted_address}, function(results, status) {
                                    if (status == 'OK') {
                                        console.log(result.results[i].formatted_address + '\n' + result.results[i].name)
                                        map.setCenter(result.results[i].geometry.location);
                                        var marker = new google.maps.Marker({
                                        map: map,
                                        zoom: 12,
                                        position: result.results[i].geometry.location
                                        });
                                    } else {
                                        alert('Geocode was not successful for the following reason: ' + status);
                                    }
                                });
                            }
                        }
                        codeAddress();
                    },
                    error:function(error){
                        console.log(`Error ${error}`)
                    },
                })
            })
        })
        //()
            
    var geocoder;
    var map;
  function initialize() {
    geocoder = new google.maps.Geocoder();
    var latlng = new google.maps.LatLng(46.9900977, -120.548778);
    var mapOptions = {
      zoom: 8,
      center: latlng
    }
    map = new google.maps.Map(document.getElementById('map'), mapOptions);
  }

  
    </script>
    

</head>

<body id="main" onload="initialize()">
    <header id="nav">
        <nav id="search">
            <ul id="nav_list">
                <li class="nav_1"><div class = "navText">TEST</div></li>
                <li class="nav_1"><div class = "navText">TEST</div></li>
                <li class="nav_1"><div class = "navText">TEST</div></li>
                <li class="nav_1"><div class = "navText">TEST</div></li>
                <li class="nav_1"><div class = "navText">TEST</div></li>
            </ul>
        </nav>
    </header>
    <div id="main_content">
        <div id="sidebar_l">
            <div id="form_container">
                <form id="address_form" method="GET" enctype="text/html">
                    <div id="input_1" class="inputBox">    
                        <label for="zipcode" class="input_label">Enter Pizza: </label>
                        <input type="text" id="faddress" name="firstAddress" 
                        placeholder="Line One..." maxlength="15" class="input_Box"><br>
                    </div>
                    <div class="submit">
                        <button type="button" id="button1">Button</button>
                    </div>
                    <div id="input_2" class="inputBox">
                        <label for="zipcodeReal" class="input_label">Enter Zipcode: </label>
                        <input type="text" id="zaddress" name="zipAddress"
                        placeholder="Zipcode..." maxlength="15" class="input_Box"><br>
                    </div>
                    <div class="submit">
                        <button type="button" id="button2" onclick="">Button</button>
                    </div>
                </form>
                <hr class="linebreak">
            </div>
            <div id="jumpToTop">
                <a href="#nav_list">Jump To Top!</a>
            </div>
        </div>
        <div id="sidebar_r">
            <div id="webTitle">
                <label><h1>Pizza Picker</h1></label>
            </div>
            <div id="map">

            </div>
            <div id="text"></div>
        </div>
    </div>
</body>
</html>
